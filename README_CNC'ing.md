# ‚öôÔ∏è CNC PCB Milling Workflow (KiCad Gerber)

This guide details the PCB milling process using two Python scripts (`pcb_preparation_v2.py` and `gerber2nc_v3.py`) to generate the necessary G-codes for single-sided PCBs.

---

## 1. Initial Setup and Bed Mesh Creation (Phase 1)

This stage uses the **preparation script** to generate alignment files and the surface compensation routine.

### ‚û°Ô∏è Files Generated by `pcb_preparation_v2.py`

| File | Purpose |
| :--- | :--- |
| `xx_BedMesh_G29_CNC` | G-code for **PROBE (Bed Mesh)** across the PCB area. |
| `xx_ContourMapping_CNC` | G-code to move the head **around the perimeter** (for verification). |
| `xx_CheckPos_CNC` | G-code to **position the tool** at the starting point (bottom-left) of the PCB. |
| `xx_ContourMapping_Visualization` | **PNG visualization** of positioning and Bed Mesh area. |

### üõ†Ô∏è Alignment and Preparation Procedure

1.  **Visual Check:**
    * Check the **PNG visualization** file to ensure the PCB is correctly centered on the Work Area.
    * Confirm the planned cutting perimeter.
2.  **Tool Change:**
    * **REPLACE THE MILLING TOOL** with the **V-Engraving Bit** (typically 30 degrees, 0.2mm tip).

#### **Alignment Verification (Contour)**

| Command | Description |
| :--- | :--- |
| **Run `xx_CheckPos_CNC`** | Positions the tool at the **bottom-left point (Start Point)** of the PCB. |
| **Note:** | The PCB must be **very firm and flat** on the CNC Work Area. Secure it using thin, quality double-sided tape. |
| **Run `xx_ContourMapping_CNC`** | Moves the tool around the **PCB perimeter** (at a safe Z height) to confirm alignment with the physical board. |

#### **PROBE Preparation (Bed Mesh)**

1.  **PROBE Connection:** Connect one PROBE wire to the board (conductive area) and the other to the milling tool tip.
2.  **Attention:** Ensure there is a **reliable electrical connection**. Failure to connect properly may cause the Z-axis to descend unchecked, risking tool breakage or significant damage.

**Run `xx_BedMesh_G29_CNC`**
-----------------------------
The CNC will traverse 16 points in the PCB area to capture imperfections and calculate surface compensation.

* **Note:** Remember to **DISCONNECT the PROBE wires** immediately upon completion.

---

## 2. Milling and Drilling (Phase 2)

This stage uses the **main script** to generate and execute the final machining files.

### ‚û°Ô∏è Files Generated by `gerber2nc_v3.py`

| File | Purpose | Bed Mesh (G420 S1) |
| :--- | :--- | :--- |
| `xx_Pre_Drill.gcode` | Center marking of all holes (Pre-drill). | **ENABLED** |
| `xx_Engraving.gcode` | Trace isolation (Milling). | **ENABLED** |
| `xx_Edge_Cut.gcode` | Final contour cut marking. | **ENABLED** |
| `xx_Small_Drill.gcode` | Drilling of small holes. | **DISABLED** |
| `xx_Large_Drill.gcode` | Drilling of large holes. | **DISABLED** |
| `xx_Visualization.png` | Machining visualization. | N/A |

### ‚ö†Ô∏è Safety Check

* Verify that the board is securely fixed, the correct V-Engraving bit is mounted and tight, and the PROBE wires are secured and away from the cutting area.

### üïπÔ∏è Execution (Milling)

**Run `xx_Engraving`**
----------------------
This G-code will HOME, start the spindle, and begin **ENGRAVING** to isolate the PCB traces, utilizing Bed Mesh compensation.

**Run `xx_Pre_Drill`**
----------------------
This G-code will HOME, start the spindle, and perform the **pre-holes** (center marking). (Uses Bed Mesh)

**Run `xx_Edge_Cut`**
----------------------
This G-code will HOME, start the spindle, and perform the **EDGE-CUT marking** for subsequent manual cutting. (Uses Bed Mesh)

### 3. Drilling (Manual Z-Referencing Required)

Due to potential drill bit length variations and the intentional **disabling of Bed Mesh** for drilling, the Z-zero must be **manually referenced** before each drilling pass.

| Reasons for disabling Bed Mesh during drilling |
| :--- |
| **1.** Hole depth precision is less critical than engraving depth. |
| **2.** It is **unsafe** to PROBE an already milled PCB, as measurement points may land on isolated (non-conductive) copper areas, preventing the PROBE trigger and risking drill bit breakage. |

#### **Z-Referencing Procedure (Repeat for Small and Large Drill)**

### Z-REFERENCING STEPS**

1.  **Tool Change:** **REPLACE** the V-Engraving bit with the appropriate **DRILL BIT** (start with the smaller diameter).
2.  **Run `xx_CheckPos_CNC`:** Positions the drill bit at the bottom-left point.
3.  **Manual Move:** After the G-code finishes, **manually jog** the drill bit to a point where the **PROBE can make contact** with an **un-milled conductive** part of the board.
    * **Caution:** Avoid placing the PROBE on already isolated traces.
4.  **Measure Z:** Send the command `G30`. Wait for the measurement and **note the Z VALUE** (e.g., Z-7.7).
5.  **Set Z-Offset:** Send the command `M206 Z(measured number)` but with the **inverted sign**.
    * Example: If the measured value is `Z-7.7`, send `M206 Z7.7`.
6.  The **Z=0 axis is now referenced** for the current drill bit.
7.  **Note:** Remember to **DISCONNECT the PROBE wires**.

**Run `xx_Small_Drill`**
-------------------------
This G-code will HOME, start the spindle, and execute the **small diameter hole drilling**.

**Repeat the entire process again starting from Tool Change, Z-Referencing to run the **`xx_Large_Drill`**.